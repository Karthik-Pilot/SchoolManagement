{% extends "base.html" %}
{% block title %}Exam Performance Report{% endblock %}
{% block content %}
<h1 class="text-2xl font-bold text-slate-900 mb-6">Exam Results Report</h1>
<form method="get" class="mb-6 bg-white rounded shadow border p-4 max-w-2xl">
    <div class="grid grid-cols-2 gap-4">
        <div><label class="block text-sm font-medium">Student</label><select name="student_id" class="w-full rounded border px-3 py-2"><option value="">All</option>{% for s in students %}<option value="{{ s.id }}" {{ 'selected' if student_id == s.id }}>{{ s.full_name }}</option>{% endfor %}</select></div>
        <div><label class="block text-sm font-medium">Class</label><select name="class_id" class="w-full rounded border px-3 py-2"><option value="">All</option>{% for c in classes %}<option value="{{ c.id }}" {{ 'selected' if class_id == c.id }}>{{ c.name }}</option>{% endfor %}</select></div>
        <div><label class="block text-sm font-medium">Exam</label><select name="exam_id" class="w-full rounded border px-3 py-2"><option value="">All</option>{% for e in exams %}<option value="{{ e.id }}" {{ 'selected' if exam_id == e.id }}>{{ e.name }}</option>{% endfor %}</select></div>
    </div>
    <div class="mt-4 flex gap-2">
        <button type="submit" class="rounded bg-primary-600 px-4 py-2 text-white">Generate</button>
        {% if rows %}<a href="{{ request.path }}?student_id={{ student_id or '' }}&class_id={{ class_id or '' }}&exam_id={{ exam_id or '' }}&export=csv" class="rounded bg-slate-200 px-4 py-2">Export CSV</a>{% endif %}
    </div>
</form>
{% if rows %}
<table class="min-w-full bg-white rounded shadow border"><thead class="bg-slate-50"><tr><th class="px-4 py-3 text-left">Student</th><th class="px-4 py-3 text-left">Exam</th><th class="px-4 py-3 text-left">Subject</th><th class="px-4 py-3 text-left">Marks</th><th class="px-4 py-3 text-left">Grade</th></tr></thead><tbody>{% for r in rows %}<tr><td class="px-4 py-3">{{ r.student }}</td><td class="px-4 py-3">{{ r.exam }}</td><td class="px-4 py-3">{{ r.get('subject', '') }}</td><td class="px-4 py-3">{{ r.marks if r.marks is not none else '-' }}</td><td class="px-4 py-3">{{ r.grade or '-' }}</td></tr>{% endfor %}</tbody></table>
{% endif %}
<a href="{{ url_for('reports.index') }}" class="text-primary-600 hover:underline mt-4 block">Back to Reports</a>
{% endblock %}
